# üîß –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï –ü–†–û–ë–õ–ï–ú –° SUPABASE

## üö® –ü–†–û–ë–õ–ï–ú–´, –ö–û–¢–û–†–´–ï –ú–´ –ò–°–ü–†–ê–í–õ–Ø–ï–ú:
1. **–ù–µ –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è –¥–∞–Ω–Ω—ã–µ –∏–∑ –ë–î** - –ø—Ä–æ–±–ª–µ–º—ã —Å RLS –ø–æ–ª–∏—Ç–∏–∫–∞–º–∏
2. **–ù–µ —Ä–∞–±–æ—Ç–∞–µ—Ç Google OAuth –Ω–∞ —Ç–µ–ª–µ—Ñ–æ–Ω–µ** - –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
3. **–ù–µ —Ä–∞–±–æ—Ç–∞–µ—Ç Magic Link** - –ø—Ä–æ–±–ª–µ–º—ã —Å —Ä–µ–¥–∏—Ä–µ–∫—Ç–∞–º–∏

---

## üìã –ü–û–®–ê–ì–û–í–û–ï –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï

### 1. –ù–ê–°–¢–†–û–ô–ö–ê SUPABASE DASHBOARD

#### 1.1. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ Supabase Dashboard
- –û—Ç–∫—Ä–æ–π—Ç–µ https://supabase.com/dashboard
- –í—ã–±–µ—Ä–∏—Ç–µ –≤–∞—à –ø—Ä–æ–µ–∫—Ç

#### 1.2. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ Authentication
1. **Settings ‚Üí Authentication ‚Üí URL Configuration**
   - Site URL: `http://localhost:3000` (–¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏)
   - Redirect URLs: 
     ```
     http://localhost:3000/auth/callback
     http://localhost:3000/account
     https://your-domain.com/auth/callback
     https://your-domain.com/account
     ```

2. **Settings ‚Üí Authentication ‚Üí Providers**
   - **Google**: –í–∫–ª—é—á–∏—Ç–µ –∏ –Ω–∞—Å—Ç—Ä–æ–π—Ç–µ OAuth
   - **Email**: –í–∫–ª—é—á–∏—Ç–µ "Enable email confirmations"
   - **Magic Link**: –í–∫–ª—é—á–∏—Ç–µ "Enable magic links"

#### 1.3. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ Google OAuth
1. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ [Google Cloud Console](https://console.cloud.google.com/)
2. –°–æ–∑–¥–∞–π—Ç–µ –Ω–æ–≤—ã–π –ø—Ä–æ–µ–∫—Ç –∏–ª–∏ –≤—ã–±–µ—Ä–∏—Ç–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π
3. –í–∫–ª—é—á–∏—Ç–µ Google+ API
4. –°–æ–∑–¥–∞–π—Ç–µ OAuth 2.0 credentials
5. –î–æ–±–∞–≤—å—Ç–µ —Ä–∞–∑—Ä–µ—à–µ–Ω–Ω—ã–µ —Ä–µ–¥–∏—Ä–µ–∫—Ç—ã:
   ```
   https://your-project.supabase.co/auth/v1/callback
   http://localhost:3000/auth/callback
   ```
6. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ Client ID –∏ Client Secret –≤ Supabase

### 2. –ò–°–ü–û–õ–ù–ï–ù–ò–ï SQL –°–ö–†–ò–ü–¢–û–í

#### 2.1. –í—ã–ø–æ–ª–Ω–∏—Ç–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–µ RLS –ø–æ–ª–∏—Ç–∏–∫–∏
1. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ **SQL Editor** –≤ Supabase Dashboard
2. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ —Ñ–∞–π–ª–∞ `database/fixed_rls_policies.sql`
3. –í—ã–ø–æ–ª–Ω–∏—Ç–µ —Å–∫—Ä–∏–ø—Ç

#### 2.2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞
```sql
-- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –≤—Å–µ —Ç–∞–±–ª–∏—Ü—ã –¥–æ—Å—Ç—É–ø–Ω—ã
SELECT table_name, table_type 
FROM information_schema.tables 
WHERE table_schema = 'public';

-- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ RLS —Å—Ç–∞—Ç—É—Å
SELECT schemaname, tablename, rowsecurity 
FROM pg_tables 
WHERE schemaname = 'public';
```

### 3. –ù–ê–°–¢–†–û–ô–ö–ê –û–ö–†–£–ñ–ï–ù–ò–Ø

#### 3.1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
–°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª `.env.local` –≤ –∫–æ—Ä–Ω–µ –ø—Ä–æ–µ–∫—Ç–∞:

```env
# Supabase Configuration
NEXT_PUBLIC_SUPABASE_URL=https://your-project.supabase.co
NEXT_PUBLIC_SUPABASE_ANON_KEY=your-anon-key

# –î–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞
NEXT_PUBLIC_SITE_URL=https://your-domain.com
```

#### 3.2. –ü–æ–ª—É—á–∏—Ç–µ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –∫–ª—é—á–∏
1. –í Supabase Dashboard ‚Üí Settings ‚Üí API
2. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ:
   - Project URL
   - anon/public key

### 4. –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–ï

#### 4.1. –¢–µ—Å—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –ë–î
```bash
npm run dev
```
–û—Ç–∫—Ä–æ–π—Ç–µ http://localhost:3000/test-connection

#### 4.2. –¢–µ—Å—Ç –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏
1. –û—Ç–∫—Ä–æ–π—Ç–µ http://localhost:3000/login
2. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –≤–æ–π—Ç–∏ —á–µ—Ä–µ–∑ Google
3. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ Magic Link

#### 4.3. –¢–µ—Å—Ç –Ω–∞ –º–æ–±–∏–ª—å–Ω–æ–º —É—Å—Ç—Ä–æ–π—Å—Ç–≤–µ
1. –ó–∞–ø—É—Å—Ç–∏—Ç–µ `npm run dev:next`
2. –û—Ç–∫—Ä–æ–π—Ç–µ –Ω–∞ —Ç–µ–ª–µ—Ñ–æ–Ω–µ: `http://your-ip:3000`
3. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—é

---

## üîç –î–ò–ê–ì–ù–û–°–¢–ò–ö–ê –ü–†–û–ë–õ–ï–ú

### –ü—Ä–æ–±–ª–µ–º–∞: "Cannot read properties of undefined"
**–†–µ—à–µ–Ω–∏–µ:** –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

### –ü—Ä–æ–±–ª–µ–º–∞: "Row Level Security policy violation"
**–†–µ—à–µ–Ω–∏–µ:** –í—ã–ø–æ–ª–Ω–∏—Ç–µ `database/fixed_rls_policies.sql`

### –ü—Ä–æ–±–ª–µ–º–∞: "Invalid redirect URI"
**–†–µ—à–µ–Ω–∏–µ:** –î–æ–±–∞–≤—å—Ç–µ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ redirect URLs –≤ Supabase

### –ü—Ä–æ–±–ª–µ–º–∞: "Google OAuth not working on mobile"
**–†–µ—à–µ–Ω–∏–µ:** 
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ Google Cloud Console
2. –î–æ–±–∞–≤—å—Ç–µ –º–æ–±–∏–ª—å–Ω—ã–µ —Ä–µ–¥–∏—Ä–µ–∫—Ç—ã
3. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ `npm run dev:next` –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

---

## üì± –û–°–û–ë–ï–ù–ù–û–°–¢–ò –î–õ–Ø –ú–û–ë–ò–õ–¨–ù–´–• –£–°–¢–†–û–ô–°–¢–í

### 1. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–π —Å–µ—Ç–∏
```bash
# –ó–∞–ø—É—Å–∫ –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –∏–∑ –ª–æ–∫–∞–ª—å–Ω–æ–π —Å–µ—Ç–∏
npm run dev:next
```

### 2. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Google OAuth –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö
–í Google Cloud Console –¥–æ–±–∞–≤—å—Ç–µ:
```
http://your-ip:3000/auth/callback
https://your-project.supabase.co/auth/v1/callback
```

### 3. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ cookies –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö
–í `middleware.ts` —É–∂–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –∑–∞–≥–æ–ª–æ–≤–∫–∏.

---

## ‚úÖ –ü–†–û–í–ï–†–ö–ê –†–ê–ë–û–¢–´

### 1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –ë–î
```javascript
// –í –±—Ä–∞—É–∑–µ—Ä–µ –∫–æ–Ω—Å–æ–ª–∏
const { data, error } = await supabase
  .from('products')
  .select('*')
  .limit(1)
console.log('Test query:', { data, error })
```

### 2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—é
```javascript
// –í –±—Ä–∞—É–∑–µ—Ä–µ –∫–æ–Ω—Å–æ–ª–∏
const { data: { session }, error } = await supabase.auth.getSession()
console.log('Session:', { session, error })
```

### 3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å–æ–∑–¥–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
–ü–æ—Å–ª–µ –≤—Ö–æ–¥–∞ –ø—Ä–æ–≤–µ—Ä—å—Ç–µ —Ç–∞–±–ª–∏—Ü—É `users` –≤ Supabase Dashboard.

---

## üöÄ –î–û–ü–û–õ–ù–ò–¢–ï–õ–¨–ù–´–ï –£–õ–£–ß–®–ï–ù–ò–Ø

### 1. –î–æ–±–∞–≤—å—Ç–µ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –æ—à–∏–±–æ–∫
```javascript
// –í SupabaseAuthProvider.tsx
if (error) {
  logger.error('Auth error:', error)
  // –û—Ç–ø—Ä–∞–≤—å—Ç–µ –≤ —Å–µ—Ä–≤–∏—Å –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞
}
```

### 2. –î–æ–±–∞–≤—å—Ç–µ fallback –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö
```javascript
// –ï—Å–ª–∏ Google OAuth –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç, –ø–æ–∫–∞–∂–∏—Ç–µ email —Ñ–æ—Ä–º—É
const isMobile = /iPhone|iPad|iPod|Android/i.test(navigator.userAgent)
```

### 3. –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö
–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å–æ–∑–¥–∞–Ω–Ω—ã–π —Ö—É–∫ `useOptimizedQuery` –¥–ª—è –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è.

---

## üìû –ü–û–î–î–ï–†–ñ–ö–ê

–ï—Å–ª–∏ –ø—Ä–æ–±–ª–µ–º—ã –æ—Å—Ç–∞—é—Ç—Å—è:
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –≤ –±—Ä–∞—É–∑–µ—Ä–µ (F12 ‚Üí Console)
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –≤ Supabase Dashboard ‚Üí Logs
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –≤ Google Cloud Console
4. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤—Å–µ SQL —Å–∫—Ä–∏–ø—Ç—ã –≤—ã–ø–æ–ª–Ω–µ–Ω—ã

**–í–∞–∂–Ω–æ:** –ü–æ—Å–ª–µ –∫–∞–∂–¥–æ–≥–æ –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ Supabase Dashboard –º–æ–∂–µ—Ç –ø–æ—Ç—Ä–µ–±–æ–≤–∞—Ç—å—Å—è –Ω–µ—Å–∫–æ–ª—å–∫–æ –º–∏–Ω—É—Ç –¥–ª—è –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π. 